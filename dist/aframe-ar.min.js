!function(e){function t(a){if(r[a])return r[a].exports;var i=r[a]={exports:{},id:a,loaded:!1};return e[a].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){r(4),r(3),r(2),r(1)},function(e,t){AFRAME.registerComponent("ar-raycaster",{dependencies:["raycaster"],schema:{x:{default:.5},y:{default:.5},el:{type:"selector"}},init:function(){this.raycaster=this.el.components.raycaster.raycaster,this.raycasterIntersectObjects=this.raycaster.intersectObjects.bind(this.raycaster),this.raycaster.intersectObjects=this.intersectObjects.bind(this)},update:function(e){this.data.el||this.el.sceneEl.object3D.el||(this.el.sceneEl.object3D.el=this.el.sceneEl)},intersectObjects:function(e,t){return this.raycasterIntersectObjects(e,t).concat(this.hitAR())},hitAR:function(){var e=new THREE.Matrix4,t=new THREE.Vector3,r=new THREE.Quaternion,a=new THREE.Vector3;return function(){var i=this.el.sceneEl.components["three-ar"];if(!i||!i.arDisplay||!i.arDisplay.hitTest)return[];var n=i.arDisplay.hitTest(this.data.x,this.data.y);return!n||n.length<=0?[]:(e.fromArray(n[0].modelMatrix),e.decompose(t,r,a),[{distance:t.distanceTo(this.el.object3D.position),point:t,object:this.data.el&&this.data.el.object3D||this.el.sceneEl.object3D}])}}()})},function(e,t){AFRAME.registerComponent("ar",{dependencies:["three-ar-planes"],init:function(){this.el.sceneEl.setAttribute("vr-mode-ui",{enabled:!1})}})},function(e,t){AFRAME.registerComponent("three-ar-planes",{dependencies:["three-ar"],init:function(){this.planes=new Map},tick:function(e,t){var r=new THREE.Vector3(1,1,1),a=new THREE.Vector3,i=new THREE.Matrix4;return function(e,t){var n=this.el.components["three-ar"];if(n&&n.arDisplay){for(var s=n.arDisplay,o={},c=s.getPlanes?s.getPlanes():s.anchors_,l=0;c&&l<c.length;l++){var h=c[l];h.identifier||(h.identifier=h.id),"string"!=typeof h.identifier&&(h.identifier=h.identifier.toString()),h.polygon&&(h.vertices=h.polygon),o[h.identifier]=!0,h.vector3||(h.vector3=new THREE.Vector3),h.quaternion||(h.quaternion=new THREE.Quaternion),h.rotation||(h.rotation=new THREE.Euler(0,0,0,"YXZ")),h.extent3||(h.extent3=new THREE.Vector3),h.transform?(i.fromArray(h.transform),i.decompose(h.vector3,h.quaternion,r)):(h.vector3.fromArray(h.position),h.quaternion.fromArray(h.orientation)),h.rotation.setFromQuaternion(h.quaternion),h.rotation.x&&(h.rotation.x*=THREE.Math.RAD2DEG),h.rotation.y&&(h.rotation.y*=THREE.Math.RAD2DEG),h.rotation.z&&(h.rotation.z*=THREE.Math.RAD2DEG),h.extent3.set(h.extent[0],0,h.extent[1]);var p=this.planes.has(h.identifier),E=!p||!AFRAME.utils.deepEqual(h,this.planes[h.identifier]);E&&(this.planes[h.identifier]=JSON.parse(JSON.stringify(h)),a.set(h.extent[0],0,h.extent[1]),this.el.emit(p?"updateplane":"createplane",{id:h.identifier,alignment:h.alignment||0,extent:h.extent3,position:h.vector3,rotation:h.rotation,scale:r}))}for(var u=Object.keys(this.planes),d=0;d<u.length;d++){var f=u[d];o[f]||(this.el.emit("removeplane",{id:f}),this.planes.delete(f))}}}}()})},function(e,t){AFRAME.registerComponent("three-ar",{schema:{takeOverCamera:{default:!0}},init:function(){this.el.sceneEl.hasLoaded?this.onceSceneLoaded():this.el.sceneEl.addEventListener("loaded",this.onceSceneLoaded.bind(this))},tick:function(e,t){if(this.arDisplay&&this.arDisplay.getFrameData&&(this.arView&&this.arView.render(),this.arCamera)){var r=this.arCamera;this.frameData||(this.frameData=new VRFrameData),this.arDisplay.getFrameData(this.frameData);var a=this.frameData.pose.position;r.el.setAttribute("position",{x:a[0],y:a[1],z:a[2]}),this.poseEuler||(this.poseEuler=new THREE.Euler(0,0,0,"YXZ")),this.poseQuaternion||(this.poseQuaternion=new THREE.Quaternion);var i=this.frameData.pose.orientation;this.poseQuaternion.set(i[0],i[1],i[2],i[3]),this.poseEuler.setFromQuaternion(this.poseQuaternion),r.el.setAttribute("rotation",{x:THREE.Math.RAD2DEG*this.poseEuler.x,y:THREE.Math.RAD2DEG*this.poseEuler.y,z:THREE.Math.RAD2DEG*this.poseEuler.z}),r.projectionMatrix.fromArray(this.frameData.leftProjectionMatrix)}},takeOverCamera:function(e){this.arCamera=e,e.isARPerspectiveCamera=!0,e.vrDisplay=this.arDisplay,e.el.setAttribute("look-controls",{enabled:!1})},onceSceneLoaded:function(){var e=this;THREE.ARUtils.getARDisplay().then(function(t){if(e.arDisplay=t,t){var r=e.el.sceneEl;e.data.takeOverCamera&&setTimeout(function(){e.takeOverCamera(r.camera)}),r.renderer.alpha=!0,r.renderer.autoClearColor=THREE.ARUtils.isARKit(t),r.renderer.autoClearDepth=!0,e.arView=new THREE.ARView(t,r.renderer)}})},getProjectionMatrix:function(){return this.arDisplay&&this.arDisplay.getFrameData?(this.frameData||(this.frameData=new VRFrameData),this.arDisplay.getFrameData(this.frameData),this.frameData.leftProjectionMatrix):null}})}]);