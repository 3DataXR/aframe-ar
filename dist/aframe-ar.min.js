!function(e){function t(i){if(a[i])return a[i].exports;var s=a[i]={exports:{},id:i,loaded:!1};return e[i].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){a(4),a(3),a(2),a(1)},function(e,t){AFRAME.registerComponent("ar-raycaster",{dependencies:["raycaster"],schema:{x:{default:.5},y:{default:.5},el:{type:"selector"}},init:function(){this.raycaster=this.el.components.raycaster.raycaster,this.raycasterIntersectObjects=this.raycaster.intersectObjects.bind(this.raycaster),this.raycaster.intersectObjects=this.intersectObjects.bind(this)},update:function(e){this.data.el||this.el.sceneEl.object3D.el||(this.el.sceneEl.object3D.el=this.el.sceneEl)},intersectObjects:function(e,t){return this.raycasterIntersectObjects(e,t).concat(this.hitAR())},hitAR:function(){var e=new THREE.Matrix4,t=new THREE.Vector3,a=new THREE.Quaternion,i=new THREE.Vector3,s=new THREE.Vector3;return function(){var r=this.el.sceneEl.components["three-ar"];if(!r||!r.arDisplay||!r.arDisplay.hitTest)return[];var n=r.arDisplay.hitTest(this.data.x,this.data.y);return!n||n.length<=0?[]:(e.fromArray(n[0].modelMatrix),e.decompose(t,a,i),this.el.object3D.getWorldPosition(s),t.add(s),[{distance:t.distanceTo(s),point:t,object:this.data.el&&this.data.el.object3D||this.el.sceneEl.object3D}])}}()})},function(e,t){AFRAME.registerComponent("ar",{dependencies:["three-ar-planes"],init:function(){this.el.sceneEl.setAttribute("vr-mode-ui",{enabled:!1})}})},function(e,t){AFRAME.registerComponent("three-ar-planes",{dependencies:["three-ar"],init:function(){this.planes={},this.anchorsAdded=[],this.anchorsAddedDetail={type:"Added",anchors:this.anchorsAdded},this.anchorsUpdated=[],this.anchorsUpdatedDetail={type:"Updated",anchors:this.anchorsUpdated},this.anchorsRemoved=[],this.anchorsRemovedDetail={type:"Removed",anchors:this.anchorsRemoved}},tick:function(e,t){var a=new THREE.Vector3(1,1,1),i=(new THREE.Vector3,new THREE.Matrix4),s=new THREE.Vector3,r=(new THREE.Vector3,new THREE.Quaternion);new THREE.Euler(0,0,0,"YXZ");return function(e,t){var n=this.el.components["three-ar"];if(n&&n.arDisplay){var o,h=n.arDisplay,c=h.getPlanes?h.getPlanes():h.anchors_,d=[],l=[],p=[],m={};for(o=0;c&&o<c.length;o++){var u=c[o],E={};E.identifier=(void 0!==u.identifier?u.identifier:u.id).toString(),u.timestamp&&(E.timestamp=u.timestamp),u.transform?(i.fromArray(u.transform),i.decompose(s,r,a),E.position=[s.x,s.y,s.z],E.orientation=[r._x,r._y,r._z,r._w],E.extent=u.extent):void 0!==E.timestamp?(E.position=u.position,E.orientation=u.orientation,E.extent=u.extent,u.polygon?E.vertices=u.polygon:u.vertices&&(E.vertices=u.vertices)):(E.position=[u.position[0],u.position[1],u.position[2]],E.orientation=[u.orientation[0],u.orientation[1],u.orientation[2],u.orientation[3]],E.extent=[u.extent[0],u.extent[1]],u.polygon?(E.vertices=[],u.polygon.forEach(function(e){E.vertices.push(e)})):u.vertices&&(E.vertices=u.vertices));var f=E.identifier;m[f]=!0,this.planes[f]?this.planes[f].timestamp?E.timestamp!==this.planes[f].timestamp&&l.push(E):AFRAME.utils.deepEqual(E,this.planes[f])||l.push(E):(this.planes[f]=void 0!==E.timestamp?E:JSON.parse(JSON.stringify(E)),d.push(E))}var D=this;Object.keys(D.planes).forEach(function(e){m[e]||(p.push(D.planes[e]),delete D.planes[e])}),this.anchorsAdded=d,d.length>0&&(this.anchorsAddedDetail.anchors=d,this.el.emit("anchorsAdded",this.anchorsAddedDetail)),this.anchorsUpdated=l,l.length>0&&(this.anchorsUpdatedDetail.anchors=l,this.el.emit("anchorsUpdated",this.anchorsUpdatedDetail)),this.anchorsRemoved=p,p.length>0&&(this.anchorsRemovedDetail.anchors=p,this.el.emit("anchorsRemoved",this.anchorsRemovedDetail))}}}()})},function(e,t){AFRAME.registerComponent("three-ar",{schema:{takeOverCamera:{default:!0}},init:function(){this.onceSceneLoaded=this.onceSceneLoaded.bind(this),this.el.sceneEl.hasLoaded?(console.log("three-ar: hasLoaded, setTimeout"),setTimeout(this.onceSceneLoaded)):(console.log("three-ar: !hasLoaded, addEventListener"),this.el.sceneEl.addEventListener("loaded",this.onceSceneLoaded))},tick:function(e,t){if(this.arDisplay&&this.arDisplay.getFrameData&&(this.arView&&this.arView.render(),this.arCamera)){var a=this.arCamera;this.frameData||(this.frameData=new VRFrameData),this.arDisplay.getFrameData(this.frameData);var i=this.frameData.pose.position;a.el.setAttribute("position",{x:i[0],y:i[1],z:i[2]}),this.poseEuler||(this.poseEuler=new THREE.Euler(0,0,0,"YXZ")),this.poseQuaternion||(this.poseQuaternion=new THREE.Quaternion);var s=this.frameData.pose.orientation;this.poseQuaternion.set(s[0],s[1],s[2],s[3]),this.poseEuler.setFromQuaternion(this.poseQuaternion),a.el.setAttribute("rotation",{x:THREE.Math.RAD2DEG*this.poseEuler.x,y:THREE.Math.RAD2DEG*this.poseEuler.y,z:THREE.Math.RAD2DEG*this.poseEuler.z}),a.projectionMatrix.fromArray(this.frameData.leftProjectionMatrix)}},takeOverCamera:function(e){this.arCamera=e,e.isARPerspectiveCamera=!0,e.vrDisplay=this.arDisplay,e.el.setAttribute("look-controls",{enabled:!1})},onceSceneLoaded:function(){var e=this;THREE.ARUtils.getARDisplay().then(function(t){if(e.arDisplay=t,t){var a=e.el.sceneEl;e.data.takeOverCamera&&setTimeout(function(){e.takeOverCamera(a.camera)}),a.renderer.alpha=!0,a.renderer.autoClearColor=THREE.ARUtils.isARKit(t),a.renderer.autoClearDepth=!0,e.arView=new THREE.ARView(t,a.renderer)}})},getProjectionMatrix:function(){return this.arDisplay&&this.arDisplay.getFrameData?(this.frameData||(this.frameData=new VRFrameData),this.arDisplay.getFrameData(this.frameData),this.frameData.leftProjectionMatrix):null}})}]);