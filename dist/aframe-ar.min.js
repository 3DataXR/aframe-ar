!function(e){function t(i){if(a[i])return a[i].exports;var r=a[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){a(4),a(3),a(2),a(1)},function(e,t){AFRAME.registerComponent("ar-raycaster",{dependencies:["raycaster"],schema:{x:{default:.5},y:{default:.5},el:{type:"selector"}},init:function(){this.raycaster=this.el.components.raycaster.raycaster,this.raycasterIntersectObjects=this.raycaster.intersectObjects.bind(this.raycaster),this.raycaster.intersectObjects=this.intersectObjects.bind(this)},update:function(e){this.data.el||this.el.sceneEl.object3D.el||(this.el.sceneEl.object3D.el=this.el.sceneEl)},intersectObjects:function(e,t){return this.raycasterIntersectObjects(e,t).concat(this.hitAR())},hitAR:function(){var e=new THREE.Matrix4,t=new THREE.Vector3,a=new THREE.Quaternion,i=new THREE.Vector3,r=new THREE.Vector3;return function(){var s=this.el.sceneEl.components["three-ar"];if(!s||!s.arDisplay||!s.arDisplay.hitTest)return[];var n=s.arDisplay.hitTest(this.data.x,this.data.y);return!n||n.length<=0?[]:(e.fromArray(n[0].modelMatrix),e.decompose(t,a,i),this.el.object3D.getWorldPosition(r),t.add(r),[{distance:t.distanceTo(r),point:t,object:this.data.el&&this.data.el.object3D||this.el.sceneEl.object3D}])}}()})},function(e,t){AFRAME.registerComponent("ar",{dependencies:["three-ar-planes"],init:function(){this.el.sceneEl.setAttribute("vr-mode-ui",{enabled:!1})}})},function(e,t){AFRAME.registerComponent("three-ar-planes",{dependencies:["three-ar"],init:function(){this.planes={},this.anchorsAdded=[],this.anchorsAddedDetail={type:"added",anchors:this.anchorsAdded},this.anchorsUpdated=[],this.anchorsUpdatedDetail={type:"updated",anchors:this.anchorsUpdated},this.anchorsRemoved=[],this.anchorsRemovedDetail={type:"removed",anchors:this.anchorsRemoved}},tick:function(e,t){var a=new THREE.Vector3(1,1,1),i=(new THREE.Vector3,new THREE.Matrix4),r=new THREE.Vector3,s=(new THREE.Vector3,new THREE.Quaternion);new THREE.Euler(0,0,0,"YXZ");return function(e,t){var n=this.el.components["three-ar"];if(n&&n.arDisplay){var o,c=n.arDisplay,h=c.getPlanes?c.getPlanes():c.anchors_,l=[],d=[],p=[],m={};for(o=0;h&&o<h.length;o++){var u,E=h[o],f=(void 0!==E.identifier?E.identifier:E.id).toString(),D=E.timestamp;m[f]=!0;var v=!this.planes[f],R=void 0!==D;if(v||!R||D!==this.planes[f].timestamp){var u={identifier:f};if(void 0!==D&&(u.timestamp=D),E.modelMatrix||E.transform?u.modelMatrix=E.modelMatrix||E.transform:(r.fromArray(E.position),s.fromArray(E.orientation),a.set(1,1,1),i.compose(r,s,a),u.modelMatrix=i.elements.slice()),u.center=E.center,u.extent=E.extent,E.polygon?u.vertices=E.polygon:E.vertices&&(u.vertices=E.vertices),v)l.push(u);else if(R)d.push(u);else{if(AFRAME.utils.deepEqual(u,this.planes[f]))continue;d.push(u)}R?this.planes[f]=u:(this.planes[f]={identifier:u.identifier,modelMatrix:u.modelMatrix.slice(),center:u.center.slice(),extent:u.extent.slice()},u.vertices&&(this.planes[f].vertices=u.vertices.slice()))}}var y=this;Object.keys(y.planes).forEach(function(e){m[e]||(p.push(y.planes[e]),delete y.planes[e])}),this.anchorsAdded=l,l.length>0&&(this.anchorsAddedDetail.anchors=l,this.el.emit("anchorsadded",this.anchorsAddedDetail)),this.anchorsUpdated=d,d.length>0&&(this.anchorsUpdatedDetail.anchors=d,this.el.emit("anchorsupdated",this.anchorsUpdatedDetail)),this.anchorsRemoved=p,p.length>0&&(this.anchorsRemovedDetail.anchors=p,this.el.emit("anchorsremoved",this.anchorsRemovedDetail))}}}()})},function(e,t){AFRAME.registerComponent("three-ar",{schema:{takeOverCamera:{default:!0}},init:function(){this.onceSceneLoaded=this.onceSceneLoaded.bind(this),this.el.sceneEl.hasLoaded?(console.log("three-ar: hasLoaded, setTimeout"),setTimeout(this.onceSceneLoaded)):(console.log("three-ar: !hasLoaded, addEventListener"),this.el.sceneEl.addEventListener("loaded",this.onceSceneLoaded))},tick:function(e,t){if(this.arDisplay&&this.arDisplay.getFrameData&&(this.arView&&this.arView.render(),this.arCamera)){var a=this.arCamera;this.frameData||(this.frameData=new VRFrameData),this.arDisplay.getFrameData(this.frameData);var i=this.frameData.pose.position;a.el.setAttribute("position",{x:i[0],y:i[1],z:i[2]}),this.poseEuler||(this.poseEuler=new THREE.Euler(0,0,0,"YXZ")),this.poseQuaternion||(this.poseQuaternion=new THREE.Quaternion);var r=this.frameData.pose.orientation;this.poseQuaternion.set(r[0],r[1],r[2],r[3]),this.poseEuler.setFromQuaternion(this.poseQuaternion),a.el.setAttribute("rotation",{x:THREE.Math.RAD2DEG*this.poseEuler.x,y:THREE.Math.RAD2DEG*this.poseEuler.y,z:THREE.Math.RAD2DEG*this.poseEuler.z}),a.projectionMatrix.fromArray(this.frameData.leftProjectionMatrix)}},takeOverCamera:function(e){this.arCamera=e,e.isARPerspectiveCamera=!0,e.vrDisplay=this.arDisplay,e.el.setAttribute("look-controls",{enabled:!1})},onceSceneLoaded:function(){var e=this;THREE.ARUtils.getARDisplay().then(function(t){if(e.arDisplay=t,t){var a=e.el.sceneEl;e.data.takeOverCamera&&setTimeout(function(){e.takeOverCamera(a.camera)}),a.renderer.alpha=!0,a.renderer.autoClearColor=THREE.ARUtils.isARKit(t),a.renderer.autoClearDepth=!0,e.arView=new THREE.ARView(t,a.renderer)}})},getProjectionMatrix:function(){return this.arDisplay&&this.arDisplay.getFrameData?(this.frameData||(this.frameData=new VRFrameData),this.arDisplay.getFrameData(this.frameData),this.frameData.leftProjectionMatrix):null}})}]);